<html>
	<head>
		<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
		<script src="https://jeremyckahn.github.io/keydrown/dist/keydrown.min.js"></script>
	</head>
	<body>
		<script>
			window.onerror=function(msg,url,ln,col,err){alert('Error\n\n'+msg+'\nLine '+ln+'\nColumn '+col+'\nStack Trace\n'+err);};
			
			const d2r = a => a*Math.PI/180 // simple
			const clamp = (a, b, c) => Math.min(Math.max(a, b), c)

			AFRAME.registerComponent('bounce', {
				schema: {
					// sineTimerHeight: { type: "number" }
				},
				init: () => {},
				tick: (time, delta) => {
					if (typeof this.el.object3D == "undefined") {return 0};
					
					this.el.object3D.rotation.y += THREE.MathUtils.degToRad(300*delta);
					this.el.object3D.position.y = Math.abs(Math.sin(d2r(time))) * 2 + 0.5;
				}
			});

			var playerHeight = 1.6
			var playerVel = new Array(0, 0, 0)
			let accel = .1
			let friction = .85
			let gravity = .01

			function applyVel(x, y, z) {
				playerVel[0] -= Math.sin(d2r(document.getElementById("player").getAttribute('rotation').y + 90)) * x
				playerVel[2] -= Math.cos(d2r(document.getElementById("player").getAttribute('rotation').y + 90)) * x

				playerVel[0] -= Math.sin(d2r(document.getElementById("player").getAttribute('rotation').y)) * z
				playerVel[2] -= Math.cos(d2r(document.getElementById("player").getAttribute('rotation').y)) * z

				playerVel[1] += y
			}
			function tick() {
				physics();
			}
			function physics() {
				let playerPos = document.getElementById("player").getAttribute('position')

				applyVel(kd.A.isDown() ? accel : (kd.D.isDown() ? -accel : 0),
					(kd.SPACE.isDown() && playerPos.y == playerHeight) ? .4 : 0,
					(kd.W.isDown() ? accel : (kd.S.isDown() ? -accel : 0))
				)
				playerVel[1] -= gravity
				
				playerVel[0] *= friction
				playerVel[2] *= friction
				
				playerVel[1] *= friction

				playerPos.x += playerVel[0];
				playerPos.z += playerVel[2];

				playerPos.y += playerVel[1];
				if (playerPos.y < playerHeight) {
					playerPos.y = playerHeight
					playerVel[1] = 0
				}
			}
			setInterval(tick, (1/60) * 1000);
		</script>
		<a-scene>
			<a-entity id="player" camera look-controls position="0 1.6 0"></a-entity>
			<a-box id="box" bounce position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
			<a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
			<a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
			<a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
			<a-sky color="#88FFF8"></a-sky>
		</a-scene>
 	</body>
</html>
